name: Build Theme Zip

on:
  release:
    types: [published]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # Crée un dossier mediapilote et y copie tous les fichiers du thème
      - name: Préparer le dossier mediapilote
        run: |
          mkdir mediapilote
          shopt -s extglob
          cp -r !(mediapilote|.git|.github) mediapilote/

      # Crée le zip avec le bon dossier à la racine
      - name: Créer l'archive zip
        run: zip -r mediapilote.zip mediapilote

      # Ajoute le zip à la release GitHub
      - name: Ajouter le zip à la release
        uses: softprops/action-gh-release@v1
        with:
          files: mediapilote.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}